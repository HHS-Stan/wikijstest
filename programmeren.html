<!--
title: Programmeer Tutorials
description: Een korte lijst van alle programmeer tutorials
published: true
date: 2020-01-30T20:47:15.351Z
tags: Programmeren
-->

<p><i>Note: Het kan zijn dat de stukjes code in de tekst fouten bevatten, ik heb de hele tutorial 'on the fly' geschreven en daarna alles opnieuw in een aparte file om het eindresultaat te bereiken. De code helemaal aan het eind (het geheel) werkt volledig!</i><br>&nbsp;</p><p><strong>Bots in C#</strong><br>&nbsp;</p><p><strong>Benodigheden</strong></p><ul><li>Een computer<br>&nbsp;</li><li>Basis kennis van C# &amp;&nbsp; OOP<br>&nbsp;</li><li>Een C# compiler</li></ul><p><strong>Inleiding</strong></p><p>In deze 'tutorial' zal ik je uitleggen hoe je door middel van Multi-Threading en Object Oriented Programming (OOP)</p><p>'bots' kunt maken. Laat me gelijk uitleggen dat ik niet ga uit leggen hoe je een bot moet maken om bijvoorbeeld</p><p>te maken. Ik zal simpelweg principes en methodes uit leggen. Ik maak uitsluitend gebruik van console applicaties in deze tutorial.</p><p>Ik moet er wel bij zeggen dat het eigenlijk onzin en verspilling van tijd om deze methode voor de onderstaande situatie&nbsp;</p><p>te gebruiken. Alhoewel ik simpelweg het principe wil demonstreren.</p><p><strong>Situatie</strong></p><p>In deze tutorial zal ik een oplossing uitleggen voor het volgende probleem:</p><p><i>Ik heb een&nbsp;</i></p><p><i><strong>List&lt;string&gt;</strong></i></p><p><i>&nbsp;met 100 URL's, van all die honderd URL's wil ik de HTML code hebben. Zodra</i></p><p><i>ik die heb wil ik doormiddel van Regular Expressions de pagina titel eruit halen in die opslaan in een lijst zodat</i></p><p><i>ik deze aan de gebruiker kan tonen.&nbsp;</i></p><p><i>Als ik dit allemaal op de main thread gan doen, zal dit zeer traag gaan, omdat we 100 HTTP requests moeten uitvoeren</i></p><p><i>en de regex moeten toepassen.</i></p><p><strong>Wat is multi-threading?</strong></p><p>Multithreading is het vermogen van een besturingssysteem om meer dan één programma tegelijk uit te voeren,&nbsp;</p><p>het maakt programma's mogelijk om verschillende taken tegelijk te verwerken. Je programma draait in principe</p><p>altijd in de main thread. Ik moet hierbij wel zeggen dat het eigenlijk maar lijkt alsof je alles tegelijk uitvoert.</p><p>Je hebt immers maar 1 processor dus daad werklijk meerdere dingen tegelijk laten doen is eigenlijk onmogelijk.&nbsp;</p><p>Alleen het lijkt met een computer altijd zo. Als je meerdere threads hebt draaien locken zij om de beurt de CPU, gebruiken</p><p>en hem en maken hem weer vrij voor een andere taak. Dit doet de computer zo effectief dat het allemaal tegelijk lijkt te gaan.</p><p>Je kunt gebruik maken van multi-threading om dus dingen te versnellen.&nbsp;</p><p>Als je een Windows Form application schrijft in het .NET framework en je wilt bijvoorbeeld door een lijst van 2 miljoen</p><p>lijnen loopen en daar een bewerking op uitvoeren. Als je dit allemaal op de main thread zal gaan doen zal het programma</p><p>vastlopen tot dat het klaar is met het uitvoeren van alle bewerking. Dit geld bijvoorbeeld ook als je 100 HTTP request</p><p>achter elkaar wilt uitvoeren, of als je een groot bestand wilt laden. Je kunt de lading verdelen over meerdere threads om</p><p>het proces te versnellen.</p><p>Het gevaar is wel dat als je bijvoorbeeld door een mega lijst van dingen heen loopt met 20 threads en elke keer als&nbsp;</p><p>een thread 'klaar' is iets aan een listbox moet toevoegen zal dit moeilijk gaan. Je kunt immers moeilijk dingen aanroepen</p><p>die op een andere thread zijn aangemaakt, form elements bijvoorbeeld. Hiervoor zijn natuurlijk oplossing in C# ingebouwd&nbsp;</p><figure class="image"><img src="https://hackflag.org/forum/images/smilies/smile.gif" alt=":)"></figure><p><strong>Hoe start ik een thread in C#?</strong></p><p>Voordat je gebruik kun maken van de threading functies en klassen moet je de&nbsp;</p><p><i>Threading</i></p><p>&nbsp;namespace importeren:</p><blockquote><p>using System.Threading;[/i]</p><p>Een thread starten is zeer makkelijk, stel je voor dat ik de volgende code heb:</p><p>[code]public void Main()</p><p>{</p><p>for(int i = 0; i &lt; 1000000; i++)</p><p>{</p><p>Console.WriteLine("Rotation: " + i.ToString());</p><p>}</p><p>}</p></blockquote><p>Stel je voor dat ik deze code in een aparte thread wil uitvoeren. We creeeren eerst een losse functie die we&nbsp;</p><p><i>Main_Threaded</i></p><p>&nbsp;noemen.</p><p>Dan roepen we vanaf&nbsp;</p><p><i>Main()</i></p><p>&nbsp;</p><blockquote><p><i>&gt;&gt;&nbsp;Main_Threaded()</i></p><p><i>&gt;&gt;&nbsp;</i>aan in een nieuwe, aparte thread:</p><p><i>&gt;&gt;&nbsp;</i>public void Main()</p><p><i>&gt;&gt;&nbsp;</i>{</p><p><i>&gt;&gt;&nbsp;</i>Thread MyThread = new Thread(Main_Threaded);</p><p><i>&gt;&gt;&nbsp;</i>MyThread.Start();</p><p><i>&gt;&gt;&nbsp;</i>}</p><p><i>&gt;&gt;&nbsp;</i>public void Main_Threaded()</p><p><i>&gt;&gt;&nbsp;</i>{</p><p><i>&gt;&gt;&nbsp;</i>for(int i = 0; i &lt; 1000000; i++)</p><p><i>&gt;&gt;&nbsp;</i>{</p><p><i>&gt;&gt;&nbsp;</i>Console.WriteLine("Rotation: " + i.ToString());</p><p><i>&gt;&gt;&nbsp;</i>}</p><p><i>&gt;&gt;&nbsp;</i>}</p></blockquote><p>Nu zal de code in&nbsp;</p><p><i>Main_Threaded()</i></p><p>&nbsp;in een aparte thread worden uitgevoerd.</p><p><strong>Het Principe</strong></p><p>We gaan een klasse schrijven die we&nbsp;</p><p><i>UrlBot</i></p><p>&nbsp;noemen. Deze klassa zal de HTML pagina ophalen en daar middel van</p><p>regular expressions de pagina titel uit halen. Deze 'bots' zullen straks allemaal naast elkaar lopen en je kunt zelf</p><p>aangeven hoeveel bots je maximaal wil gebruiken.</p><p><strong>Onze 'main file'&nbsp;</strong></p><p>Laten we beginnen met gewoon onze lege file:</p><p>using System;</p><p>using System.Collections.Generic;</p><p>using System.IO;</p><p>using System.Net;</p><p>using System.Threading;</p><p>using System.Text;</p><p>using System.Text.RegularExpressions;</p><p>class MainClass</p><p>{</p><p>public static void Main (string[] args)</p><p>{</p><p>}</p><p>}</p><p>Hier beginnen we dus mee. Om te beginnen gaan we eerst twee&nbsp;</p><p><i>List&lt;string&gt;</i></p><p>&nbsp;aanmaken. Eentje die alle URL's in zich heeft</p><p>waarvan de HTML code en de pagina titel willen ophalen en eentje waar de pagina titels in op slaan. Deze defineren we boven de main functie:</p><p>List&lt;string&gt; Urls = new List&lt;string&gt;();</p><p>List&lt;string&gt; PaginaTitels = new List&lt;string&gt;();</p><p>Nu gaan we eerst aan het begin van onze main functie alle urls uit een tekst bestandje in de 'list' genaamd&nbsp;</p><p><i>Urls</i></p><p>&nbsp;laden:</p><p>StreamReader Reader = new StreamReader("C:\\Users\\Kirk\\urls.txt");</p><p>while(Reader.Peek() &gt; 0)</p><p>{</p><p>Urls.Add(Reader.ReadLine());</p><p>}</p><p><strong>De UrlBot klasse</strong></p><p>Nu kunnen we gaan beginnen aan de url bot klasse. We maken een nieuwe klas die we dus&nbsp;</p><p><i>UrlBot</i></p><p>&nbsp;noemen. De constructor</p><p>krijgt 3 argumenten. Ook maken we een&nbsp;</p><p><i>boolean</i></p><p>&nbsp;genaamd&nbsp;</p><p><i>StopBot</i></p><p>&nbsp;aan en 3 functies genaamd:</p><ul><li>Start()<br>&nbsp;</li><li>Run()<br>&nbsp;</li><li>Stop()</li></ul><p>Waarvan&nbsp;</p><p><i>Run()</i></p><p>&nbsp;'private' zal zijn en de twee andere public. De&nbsp;</p><p><i>Stop()</i></p><p>&nbsp;functie zal&nbsp;</p><p><i>StopBot</i></p><p>&nbsp;op&nbsp;</p><p><strong>true</strong></p><p>zetten.</p><p>class UrlBot</p><p>{</p><p>// Maak lege lists aan</p><p>public List&lt;string&gt; Urls = new List&lt;string&gt;();</p><p>public List&lt;string&gt; PaginaTitels = new List&lt;string&gt;();</p><p>// Stop boolean</p><p>public bool StopBot = false;</p><p>// Int id</p><p>int ID = 0;</p><p>// Constructor</p><p>public UrlBot(int Id, List&lt;string&gt; _Urls, List&lt;string&gt; _PaginaTitels)</p><p>{</p><p>// Urls wordt _Urls en PaginaTitels wordt _PaginaTitels:</p><p>Urls = _Urls;</p><p>PaginaTitels = _PaginaTitels;</p><p>ID = Id;</p><p>}</p><p>// Stop functie</p><p>public void Stop()</p><p>{</p><p>StopBot = true;</p><p>}</p><p>// Start functie</p><p>public void Start()</p><p>{</p><p>}</p><p>// Run functie</p><p>private void Run()</p><p>{</p><p>}</p><p>// Functie die regex gebruikt om de pagina titel uit de html te filteren</p><p>private string GetTitle(string file)</p><p>{</p><p>Match m = Regex.Match(file, @"&lt;title&gt;\s*(.+?)\s*&lt;/title&gt;");</p><p>if (m.Success)</p><p>{</p><p>return m.Groups[1].Value;</p><p>}</p><p>else</p><p>{</p><p>return "";</p><p>}</p><p>}</p><p>}</p><p>De bedoeling van deze code is dat de&nbsp;</p><p><i>Start()</i></p><p>&nbsp;functie&nbsp;</p><p><i>Run</i></p><p>&nbsp;in een nieuwe thread start. Oftewel in de&nbsp;</p><p><i>Run()</i></p><p>&nbsp;functie zal</p><p>alle code uitgevoerd worden (HTTP Request, Regular Expressions).</p><p><strong>De Start() funcite</strong></p><p>Zoals all gezegd zal de&nbsp;</p><p><i>Start()</i></p><p>&nbsp;functie de&nbsp;</p><p><i>Run()</i></p><p>&nbsp;functie in een nieuwe thread starten:</p><p>Thread Mybot = new Thread(Run);</p><p>MyBot.Start();</p><p><strong>De Run() functie</strong></p><p>In de run functie zal een&nbsp;</p><p><i>while</i></p><p>&nbsp;loop komen. Deze loop blijft zich herhalen totdat&nbsp;</p><p><i>StopBot</i></p><p>&nbsp;'true' of&nbsp;</p><p><i>Urls</i></p><p>&nbsp;0 is. Bij elke</p><p>ronde zal deze het eerste item uit de list (</p><p><i>Urls</i></p><p>) halen en deze meteen verwijderen. Vervolgens haalt de code</p><p>de HTML pagina op en haalt door middel van regular expressions de pagina titel op en voegt deze toe aan de&nbsp;</p><p><i>PaginaTitels</i></p><p>&nbsp;</p><p>list.</p><p>while(StopBot == false)</p><p>{</p><p>// Controleer of Urls niet 0 is</p><p>if(Urls.Count == 0) break;</p><p>// Haal eerste item uit URLS op en verwijder meteen</p><p>string Url = Urls[0];</p><p>Urls.RemoveAt(0);</p><p>// Haal HTMl pagina op</p><p>string Html = "";</p><p>try</p><p>{</p><p>Html = new WebClient().DownloadString(Url);</p><p>}</p><p>catch(Exception)</p><p>{</p><p>Console.WriteLine("Bot " + ID + " vind dat het onmogelijk is om " + Url + " op te halen.");</p><p>continue;</p><p>}</p><p>// Pas regular expression toe:</p><p>string PaginaTitel = GetTitle(Html);</p><p>// voeg aan list toe</p><p>PaginaTitels.Add(PaginaTitel);</p><p>// bericht</p><p>Console.WriteLine("Bot " + ID + " vond: " + PaginaTitel);</p><p>}</p><p>Console.WriteLine("Bot " + ID.ToString() + " is gestopt");</p><p><strong>De bots starten</strong></p><p>Nu we de&nbsp;</p><p><i>UrlBot</i></p><p>&nbsp;klasse af hebben kun we een stukje code schrijven om de bots te starten, voor deze tutorial gebruik ik dit:</p><p>// verkrijg het aantal maximale threads van de gebruiker</p><p>int MaxThread = 0;</p><p>try</p><p>{</p><p>Console.Write("Maximaal aantal bots: ");</p><p>string Line = Console.ReadLine();</p><p>MaxThread=&nbsp; Convert.ToInt32(Line);</p><p>}</p><p>catch(Exception)</p><p>{</p><p>Console.WriteLine("Dat is geen getal MONGOL!");</p><p>return;</p><p>}</p><p>// Creeer aan de hand van het maximaal antaal bots de benodigde instanties van de UrlBot klassen</p><p>// en voeg deze toe aan een List.</p><p>List&lt;UrlBot&gt; Bots = new List&lt;UrlBot&gt;();</p><p>for(int i = 0; i &lt; MaxThread; i++)</p><p>{</p><p>UrlBot B = new UrlBot(i, Urls, PaginaTitels);</p><p>Bots.Add(B):</p><p>}</p><p>// Loop door alle bots heen en start ze</p><p>foreach(UrlBot B in Bots)</p><p>{</p><p>// Start bot</p><p>B.Start();</p><p>}</p><p>De bovenstaande code in kun je in de main functie plakken. Zie de comments voor uitleg.</p><p><strong>Totaal plaatje</strong></p><p>Als we even alle code bij elkaar stoppen krijgen we dit:</p><p>using System;</p><p>using System.Collections.Generic;</p><p>using System.IO;</p><p>using System.Net;</p><p>using System.Threading;</p><p>using System.Text;</p><p>using System.Text.RegularExpressions;</p><p>public class MainClass</p><p>{</p><p>public static List&lt;string&gt; Urls = new List&lt;string&gt;();</p><p>public static List&lt;string&gt; PaginaTitels = new List&lt;string&gt;();</p><p>public static void Main (string[] args)</p><p>{</p><p>StreamReader Reader = new StreamReader("/Users/Swen/Desktop/urls.txt");</p><p>while(Reader.Peek() &gt; 0)</p><p>{</p><p>Urls.Add(Reader.ReadLine());</p><p>}</p><p>int MaxThread = 0;</p><p>try</p><p>{</p><p>Console.Write("Maximaal aantal bots: ");</p><p>string Line = Console.ReadLine();</p><p>MaxThread =&nbsp; Convert.ToInt32(Line);</p><p>}</p><p>catch(Exception)</p><p>{</p><p>Console.WriteLine("Dat is geen getal MONGOL!");</p><p>return;</p><p>}</p><p>// Creeer aan de hand van het maximaal antaal bots de benodigde instanties van de UrlBot klassen</p><p>// en voeg deze toe aan een List.</p><p>List&lt;UrlBot&gt; Bots = new List&lt;UrlBot&gt;();</p><p>for(int i = 0; i &lt; MaxThread; i++)</p><p>{</p><p>UrlBot B = new UrlBot(i, Urls, PaginaTitels);</p><p>Bots.Add(B);</p><p>}</p><p>// Loop door alle bots heen en start ze</p><p>foreach(UrlBot B in Bots)</p><p>{</p><p>// Start bot</p><p>B.Start();</p><p>}</p><p>}</p><p>}</p><p>public class UrlBot</p><p>{</p><p>// Maak lege lists aan</p><p>public List&lt;string&gt; Urls = new List&lt;string&gt;();</p><p>public List&lt;string&gt; PaginaTitels = new List&lt;string&gt;();</p><p>// Stop boolean</p><p>public bool StopBot = false;</p><p>// Int id</p><p>int ID = 0;</p><p>// Constructor</p><p>public UrlBot(int Id, List&lt;string&gt; _Urls, List&lt;string&gt; _PaginaTitels)</p><p>{</p><p>// Urls wordt _Urls en PaginaTitels wordt _PaginaTitels:</p><p>Urls = _Urls;</p><p>PaginaTitels = _PaginaTitels;</p><p>ID = Id;</p><p>}</p><p>// Stop functie</p><p>public void Stop()</p><p>{</p><p>StopBot = true;</p><p>}</p><p>// Start functie</p><p>public void Start()</p><p>{</p><p>Thread MyBot = new Thread(Run);</p><p>MyBot.Start();</p><p>}</p><p>// Run functie</p><p>private void Run()</p><p>{</p><p>Console.WriteLine("Bot " + ID.ToString() + " is gestart!");</p><p>while(StopBot == false)</p><p>{</p><p>// Controleer of Urls niet 0 is</p><p>if(Urls.Count == 0) break;</p><p>// Haal eerste item uit URLS op en verwijder meteen</p><p>string Url = Urls[0];</p><p>Urls.RemoveAt(0);</p><p>// Haal HTMl pagina op</p><p>string Html = "";</p><p>try</p><p>{</p><p>Html = new WebClient().DownloadString(Url);</p><p>}</p><p>catch(Exception)</p><p>{</p><p>Console.WriteLine("Bot " + ID + " vind dat het onmogelijk is om " + Url + " op te halen.");</p><p>continue;</p><p>}</p><p>// Pas regular expression toe:</p><p>string PaginaTitel = GetTitle(Html);</p><p>// voeg aan list toe</p><p>PaginaTitels.Add(PaginaTitel);</p><p>// bericht</p><p>Console.WriteLine("Bot " + ID + " vond: " + PaginaTitel);</p><p>}</p><p>Console.WriteLine("Bot " + ID.ToString() + " is gestopt");</p><p>}&nbsp;</p><p>private string GetTitle(string file)</p><p>{</p><p>Match m = Regex.Match(file, @"&lt;title&gt;\s*(.+?)\s*&lt;/title&gt;");</p><p>if (m.Success)</p><p>{</p><p>return m.Groups[1].Value;</p><p>}</p><p>else</p><p>{</p><p>return "";</p><p>}</p><p>}</p><p>}</p><p>Als je de bovenstaande code uitvoert en een bestandje hebt&nbsp;</p><p><i>urls.txt</i></p><p>&nbsp;met een lijst van URLS erin hoe je alleen</p><p>het aantal bots dat je wilt gebruiken invoeren en de bots zullen razend snel de titels van de pagina's er uit filteren.</p><p><strong>Conclusie</strong></p><p>Ik gebruik dit principe in vele van mijn programma's. Het is effectief want je kunt de code in&nbsp;</p><p><i>UrlBot</i></p><p>&nbsp;makkelijk</p><p>en snel aanpassen en het starten van de bots is een eitje!</p><p>Als er nog vragen zijn...</p>